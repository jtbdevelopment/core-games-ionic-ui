!function(o){o.module("coreGamesIonicUi.config",[]).value("coreGamesIonicUi.config",{debug:!0}),o.module("coreGamesIonicUi.controllers",[]),o.module("coreGamesIonicUi.services",[]),o.module("coreGamesIonicUi",["ionic","ngCordova","coreGamesUi","coreGamesIonicUi.config","coreGamesIonicUi.services","coreGamesIonicUi.controllers"])}(angular),angular.module("coreGamesIonicUi.controllers").controller("CoreIonicNetworkCtrl",["$scope","$state","$cordovaNetwork","$timeout","$window","ENV",function(o,e,n,i,t,r){function c(){e.go("signin")}function a(){o.message="Checking network status...",0===t.location.href.indexOf("file")&&"localhost"!==r.domain?i(function(){try{if(n.isOnline())return c(),void 0}catch(e){if("navigator.connection is undefined"===e.message)return c(),void 0;console.log(e)}o.message="Internet not currently available."},1e3):c()}o.$on("$cordovaNetwork:online",function(){c()}),o.$on("$ionicView.enter",function(){a()}),a()}]),angular.module("coreGamesIonicUi.controllers").controller("CoreIonicSignedInCtrl",["$scope","$state","$rootScope","$cacheFactory",function(o,e,n,i){function t(){i.get("$http").removeAll()}function r(){console.log("Logged in"),t(),n.$broadcast("login"),e.go("app.games")}o.$on("$ionicView.enter",function(){r()})}]),angular.module("coreGamesIonicUi.controllers").controller("CoreIonicSignInCtrl",["$scope","$window","$http","$state","$cacheFactory","jtbFacebook","ENV","$ionicLoading",function(o,e,n,i,t,r,c,a){function s(){t.get("$http").removeAll()}function l(){a.hide(),i.go("signedin")}function u(){a.hide(),console.log("Login failed"),s(),o.message="Invalid username or password."}function g(){o.showFacebook=!0,o.showManual="localhost"===c.domain||c.apiEndpoint.indexOf("-dev")>-1,o.message=""}function d(){o.showFacebook=!1,o.showManual=!1,o.message="Logging in via Facebook",s(),0===e.location.href.indexOf("file")?n.get(c.apiEndpoint+"/auth/facebook?code="+r.currentAuthorization().accessToken).success(l).error(u):e.location=c.apiEndpoint+"/auth/facebook"}o.message="",o.showFacebook=!1,o.showManual=!1,o.manualForm={username:"",password:"",rememberme:!1},o.manualLogin=function(){a.show({template:"Sending..."}),s(),n({transformRequest:function(o){var e=[];for(var n in o)o.hasOwnProperty(n)&&e.push(encodeURIComponent(n)+"="+encodeURIComponent(o[n]));return e.join("&")},url:"/signin/authenticate",data:{username:o.manualForm.username,password:o.manualForm.password,"remember-me":o.manualForm.rememberme},headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST"}).success(l).error(u)},o.fbLogin=function(){r.initiateFBLogin().then(function(o){o.auto?d():g()},function(){g()})},o.$on("$ionicView.enter",function(){r.canAutoSignIn().then(function(o){s(),o.auto?d():g()},function(){g()})})}]);var WEEK_IN_MILLIS=6048e5;angular.module("coreGamesIonicUi.services").factory("jtbPushNotifications",["$http","$rootScope","$window","jtbLocalStorage","jtbPlayerService",function(o,e,n,i,t){function r(e){if(console.log("register token called with "+JSON.stringify(e)),angular.isDefined(e)&&null!=e&&e.length>0&&"OK"!==e){console.log("Checking..");var n="pushNotification-"+t.currentPlayer().md5,r=n+"-token",c=n+"-last",a=i.get(r,""),s=new Date(parseInt(i.get(c,"0")));console.log("Last reg "+s.toLocaleString());var u=s-new Date;u>WEEK_IN_MILLIS||e!==a?(console.log("Registering"),o.put("/api/notifications/register/"+e).success(function(){i.set(r,e),i.set(c,(new Date).getTime()),l=e,console.log("registered device")}).error(function(o){console.error("failed to register device "+JSON.stringify(o))})):console.log("Recently registered.")}else console.log("Not registering")}function c(o){console.log(JSON.stringify(o))}function a(o){console.log("error in push "+JSON.stringify(o))}function s(o){console.log("registration event "+JSON.stringify(o)),r(o.registrationId)}var l,u;return e.$on("playerLoaded",function(){o.get("/api/notifications/senderID").success(function(o){if(angular.isDefined(PushNotification)&&"NOTSET"!==o)if(angular.isDefined(u))console.log("Already registered for push");else{var e;e={android:{senderID:o,sound:!1,vibrate:!0},ios:{senderID:o,alert:!0,badge:!0,sound:!1,clearBadge:!0},windows:{}},u=PushNotification.init(e),u.on("registration",s),u.on("notification",c),u.on("error",a),console.log("Initial registration for push completed")}else console.log("No pushNotification defined or sender id not set (senderId = "+o)}).error(function(o){console.log("Not able to get senderID "+JSON.stringify(o))})}),{register:function(){}}}]);