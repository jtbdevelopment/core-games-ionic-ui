!function(e){e.module("coreGamesIonicUi.config",[]).config(["$httpProvider",function(e){e.defaults.withCredentials=!0}]).value("coreGamesIonicUi.config",{debug:!0}),e.module("coreGamesIonicUi.templates",[]),e.module("coreGamesIonicUi.controllers",[]),e.module("coreGamesIonicUi.services",[]),e.module("coreGamesIonicUi.interceptors",[]),e.module("coreGamesIonicUi",["ionic","ngCordova","coreGamesUi","coreGamesIonicUi.templates","coreGamesIonicUi.config","coreGamesIonicUi.interceptors","coreGamesIonicUi.services","coreGamesIonicUi.controllers"])}(angular),angular.module("coreGamesIonicUi.controllers").controller("CoreIonicNetworkCtrl",["$scope","$state","$cordovaNetwork","$timeout","$window","ENV",function(e,i,n,o,t,a){function s(){i.go("signin")}function c(){l.message="Checking network status...",0===t.location.href.indexOf("file")&&"localhost"!==a.domain?o(function(){try{if(n.isOnline())return s(),void 0}catch(e){if("navigator.connection is undefined"===e.message)return s(),void 0;console.log(e)}l.message="Internet not currently available."},1e3):s()}var l=this;e.$on("$cordovaNetwork:online",function(){s()}),e.$on("$ionicView.enter",function(){c()}),c()}]),angular.module("coreGamesIonicUi.controllers").controller("CoreIonicSignedInCtrl",["$scope","$state","$rootScope","$cacheFactory",function(e,i,n,o){function t(){o.get("$http").removeAll()}function a(){console.log("Logged in"),t(),n.$broadcast("login"),i.go("app.games")}e.$on("$ionicView.enter",function(){a()})}]),angular.module("coreGamesIonicUi.controllers").controller("CoreIonicSignInCtrl",["$scope","$window","$http","$state","$cacheFactory","jtbFacebook","ENV","$ionicLoading",function(e,i,n,o,t,a,s,c){function l(){t.get("$http").removeAll()}function r(){c.hide(),o.go("signedin")}function d(){c.hide(),console.log("Login failed"),l(),v.message="Invalid username or password."}function u(){v.showFacebook=!0,v.showManual="localhost"===s.domain||s.apiEndpoint.indexOf("-dev")>-1,v.message=""}function m(){v.showFacebook=!1,v.showManual=!1,v.message="Logging in via Facebook",l(),0===i.location.href.indexOf("file")?n.get(s.apiEndpoint+"/auth/facebook?code="+a.currentAuthorization().accessToken).success(r).error(d):i.location=s.apiEndpoint+"/auth/facebook"}var v=this;v.message="",v.showFacebook=!1,v.showManual=!1,v.manualForm={username:"",password:"",rememberMe:!1},v.manualLogin=function(){c.show({template:"Sending..."}),l(),n({transformRequest:function(e){var i=[];for(var n in e)e.hasOwnProperty(n)&&i.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return i.join("&")},url:"/signin/authenticate",data:{username:v.manualForm.username,password:v.manualForm.password,"remember-me":v.manualForm.rememberMe},headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST"}).success(r).error(d)},v.fbLogin=function(){a.initiateFBLogin().then(function(e){e.auto?m():u()},function(){u()})},e.$on("$ionicView.enter",function(){a.canAutoSignIn().then(function(e){l(),e.auto?m():u()},function(){u()})})}]),angular.module("coreGamesIonicUi.interceptors").factory("jtbApiEndpointInterceptor",["$q","ENV",function(e,i){return{request:function(e){return(e.url.indexOf("/api")>=0||e.url.indexOf("/auth")>=0||e.url.indexOf("/signout")>=0||e.url.indexOf("/livefeed")>=0||e.url.indexOf("/signin/authenticate")>=0)&&e.url.indexOf(i.apiEndpoint)<0&&(e.url=i.apiEndpoint+e.url),e}}}]).config(["$httpProvider",function(e){e.interceptors.push("jtbApiEndpointInterceptor")}]),angular.module("coreGamesIonicUi.services").run(["$document","$state","$ionicLoading","$timeout","jtbLiveGameFeed",function(e,i,n,o,t){function a(){n.hide(),i.go("network")}var s,c=0;e.bind("pause",function(){console.warn("pause detected"),++c,s=o(function(){c>0?(console.info("pauseResumeStack still in pause - shutting down live feed"),c=0,s=void 0,t.suspendFeed()):console.info("ignoring pauseResumeStack, stack back to 0")},18e4)}),e.bind("resume",function(){console.warn("resume detected"),c>0?(console.info("pauseResumeStack stack reduced"),--c,0===c&&angular.isDefined(s)&&(console.info("clearing pause promise"),o.cancel(s),s=void 0)):(console.info("pauseResumeStack empty - full reconnect"),a())})}]),angular.module("coreGamesIonicUi.services").run(["$rootScope","$state","$ionicLoading","$ionicPopup",function(e,i,n,o){function t(){n.hide(),o.alert({title:"There was a problem!",template:"Going to reconnect!"}),i.go("network")}e.$on("InvalidSession",function(){"signin"!==i.$current.name?t():n.hide()}),e.$on("GeneralError",function(){t()}),e.$on("$cordovaNetwork:offline",function(){t()})}]),angular.module("coreGamesIonicUi.services").service("jtbIonicInviteFriends",["$ionicModal","$rootScope","jtbFacebook",function(e,i,n){return{inviteFriendsToPlay:function(o,t,a){angular.isUndefined(a)&&(a="templates/core-ionic/friends/invite-friends.html");var s,c=i.$new();c.invitableFriends=o,c.inviteFriends=function(e){var i=[];angular.forEach(e,function(e){i.push(e.id)}),n.inviteFriends(i,t),s.hide(),s.remove()},c.cancelInviteFriends=function(){s.hide(),s.remove()},e.fromTemplateUrl(a,{scope:c,animation:"slide-in-up"}).then(function(e){s=e,e.show()})}}}]);var WEEK_IN_MILLIS=6048e5;angular.module("coreGamesIonicUi.services").factory("jtbPushNotifications",["$http","$rootScope","$timeout","$window","jtbLocalStorage","jtbPlayerService",function(e,i,n,o,t,a){function s(i){if(console.log("register token called with "+JSON.stringify(i)),angular.isDefined(i)&&null!=i&&i.length>0&&"OK"!==i){console.log("Checking..");var n="pushNotification-"+a.currentPlayer().md5,o=n+"-token",s=n+"-last",c=t.get(o,""),l=new Date(parseInt(t.get(s,"0")));console.log("Last reg "+l.toLocaleString());var r=new Date-l;r>WEEK_IN_MILLIS||i!==c?(console.log("Registering"),e.put("/api/notifications/register/"+i).success(function(){t.set(o,i),t.set(s,(new Date).getTime()),d=i,console.log("registered device")}).error(function(e){console.error("failed to register device "+JSON.stringify(e))})):console.log("Recently registered.")}else console.log("Not registering")}function c(e){if(angular.isDefined(e.count)&&angular.isDefined(u))try{u.setApplicationIconBadgeNumber(function(){},function(){console.log("Failed to set badge")},e.count)}catch(i){}}function l(){}function r(e){s(e.registrationId)}var d,u;return i.$on("playerLoaded",function(){e.get("/api/notifications/senderID",{cache:!0}).success(function(e){if("NOTSET"!==e)if(angular.isDefined(window.PushNotification))if(angular.isDefined(u))console.log("Already registered for push, skipping");else{var i={android:{senderID:e,sound:!1,vibrate:!0},ios:{senderID:e,alert:!0,badge:!0,sound:!1,clearBadge:!0},windows:{}};u=PushNotification.init(i),u.on("registration",function(e){console.log("Registration "+JSON.stringify(e)),n(r(e))}),u.on("notification",function(e){console.log("Notification "+JSON.stringify(e)),n(c(e))}),u.on("error",function(e){console.log("Error "+JSON.stringify(e)),n(l(e))}),console.log("Initial registration for push completed")}else console.log("No PushNotification defined");else console.log("No sender id set (senderId = "+e+")")}).error(function(e){console.log("Not able to get senderID "+JSON.stringify(e))})}),{}}]),angular.module("coreGamesIonicUi.services").factory("jtbIonicVersionNotesService",["$ionicPopup","jtbPlayerService",function(e,i){return{displayVersionNotesIfAppropriate:function(n,o){i.currentPlayer().lastVersionNotes<n&&(e.alert({title:"Welcome to version "+n+"!",template:o}),i.updateLastVersionNotes(n))}}}]),angular.module("coreGamesIonicUi.templates").run(["$templateCache",function(e){e.put("templates/core-ionic/actions/action-confirm-dialog.html",'<!--  TODO --><div class="game-confirm-dialog"><div class="modal-header"><h4 class="modal-title">{{confirmDialog.confirmMessage}}</h4></div><div class="modal-body"><span class="confirm-message">Are you sure?</span></div><div class="modal-footer"><button class="btn btn-default btn-danger action-button" ng-click="confirmDialog.takeAction()">Yes</button> <button class="btn btn-default btn-default btn-default-focus cancel-button" ng-click="confirmDialog.cancelAction()">No</button></div></div>'),e.put("templates/core-ionic/actions/action-error-dialog.html",'<!--  TODO --><div class="game-error-dialog" role="dialog"><div class="modal-header"><h4 class="modal-title">Sorry!</h4></div><div class="modal-body"><span class="error-message">{{errorDialog.errorMessage}}</span></div><div class="modal-footer"><button class="btn btn-default btn-info btn-default-focus close-button" ng-click="errorDialog.closeError()">OK</button></div></div>'),e.put("templates/core-ionic/friends/invite-friends.html",'<!--  TODO - not using controllerAs because ionic modal 1.x does not support it --><div class="modal"><div class="invite-friends"><ion-header-bar><h1 class="title">Invite Friends!</h1></ion-header-bar><ion-content><div class="list"><label class="item item-input"><div style="width: 100%"><div class="input-label">Friends To Invite:</div></div></label><div angular-multi-select class="ams_container" min-search-length="1" helper-elements="filter noall nonone noreset" input-model="invitableFriends" output-model="friendsToInvite" button-template="angular-multi-select-btn-data.htm" item-label="<[ name ]>" search-property="name" button-label="<[ name ]>"></div></div><a class="button button-full button-submit" ng-click="inviteFriends(friendsToInvite)">Invite </a><a class="button button-full button-quit" ng-click="cancelInviteFriends()">Cancel</a></ion-content></div></div>'),e.put("templates/core-ionic/admin/admin-stats.html",'<div class="admin-stats"><div class="row text-right"><div class="col"></div><div class="col">Last 24 hours</div><div class="col">Last 7 days</div><div class="col">Last 30 days</div></div><div class="row text-right"><div class="col-25 text-left">Total Games</div><div class="col-75">{{admin.gameCount}}</div></div><div class="row text-right"><div class="col text-left">Games Created</div><div class="col">{{admin.gamesLast24hours}}</div><div class="col">{{admin.gamesLast7days}}</div><div class="col">{{admin.gamesLast30days}}</div></div><div class="row text-right"><div class="col-25 text-left">Total Players</div><div class="col-75">{{admin.playerCount}}</div></div><div class="row text-right"><div class="col text-left">Players Created</div><div class="col">{{admin.playersCreated24hours}}</div><div class="col">{{admin.playersCreated7days}}</div><div class="col">{{admin.playersCreated30days}}</div></div><div class="row text-right"><div class="col text-left">Players Logged In</div><div class="col">{{admin.playersLastLogin24hours}}</div><div class="col">{{admin.playersLastLogin7days}}</div><div class="col">{{admin.playersLastLogin30days}}</div></div></div>'),e.put("templates/core-ionic/admin/admin-switch-player.html",'<div class="admin-user"><div class="row row-center"><div class="col-25"><button class="button button-full button-positive button-stop-simulating" ng-disabled="!admin.revertEnabled" ng-click="admin.revertToNormal()">Stop</button></div><div class="col-75">{{admin.revertText}}</div></div><div class="row row-center"><div class="col-25"><button class="button button-full button-energized button-get-users" ng-click="admin.refreshData()">Get Users</button></div><div class="col-75"><div class="list"><label class="item item-input"><input type="text" ng-model="admin.searchText" placeholder="And Name contains.."></label></div></div></div><div class="item item-divider"><div class="row"><div class="col-50">Display Name</div><div class="col-25">ID</div><div class="col-25">Switch</div></div></div><div class="item" ng-repeat="player in admin.players"><div class="row row-center"><div class="col-50">{{player.displayName}}</div><div class="col-25">{{player.id}}</div><div class="col-25"><button class="button button-full button-assertive button-change-user" ng-click="admin.switchToPlayer(player.id)">Switch</button></div></div></div><div class="row"><div class="col-10">{{admin.currentPage}} of {{admin.numberOfPages}}</div><div class="col-90"><div class="item range range-positive"><input type="range" name="currentPage" min="1" max="{{admin.numberOfPages}}" ng-model="admin.currentPage" ng-change="admin.changePage()"></div></div></div></div>'),e.put("templates/core-ionic/admin/admin.html",'<ion-view class="admin-screen"><ion-content class="has-header" ng-cloak><div class="row"><div class="col-50"><a class="button-full button {{main.adminShowStats ? \'selected\' : \'\'}}" ng-click="main.adminSwitchToStats()">Stats</a></div><div class="col-50"><a class="button-full button {{main.adminShowSwitch ? \'selected\' : \'\'}}" ng-click="main.adminSwitchToSwitchPlayer()">Switch Player</a></div></div><div ng-show="main.adminShowStats"><div ng-include="\'templates/core-ionic/admin/admin-stats.html\'"></div></div><div ng-show="main.adminShowSwitch"><div ng-include="\'templates/core-ionic/admin/admin-switch-player.html\'"></div></div></ion-content></ion-view>'),e.put("templates/core-ionic/sign-in/network.html",'<ion-view><ion-content class="network"><div><div class="row text-center"><div class="center"><p>{{network.message}}</p></div></div></div></ion-content></ion-view>'),e.put("templates/core-ionic/sign-in/sign-in.html",'<ion-view><ion-content class="sign-in" ng-cloak><div class="row text-center"><div class="center"><p>{{signIn.message}}</p></div></div><div class="list" ng-show="signIn.showFacebook"><a class="item item-button" href="#" ng-click="signIn.fbLogin()"><img ng-src="images/sign-in-with-facebook.png"></a></div><div class="list" ng-show="signIn.showManual"><span class="item item-divider">Don\'t want to login with Facebook?</span><label class="item item-input"><span class="input-label">Email</span> <input id="username" name="username" type="email" size="25" ng-model="signIn.manualForm.username"></label><label class="item item-input"><span class="input-label">Password</span> <input id="password" name="password" type="password" size="25" ng-model="signIn.manualForm.password"></label><ion-toggle ng-model="signIn.manualForm.rememberMe">Remember Me?</ion-toggle><a class="button-full button-submit button" ng-click="signIn.manualLogin(username, password)">Login</a></div></ion-content></ion-view>'),e.put("templates/core-ionic/sign-in/signed-in.html",'<ion-view><ion-content class="signed-in"><div><div class="row text-center"><div class="center"><p>Login successful...</p></div></div></div></ion-content></ion-view>')}]);