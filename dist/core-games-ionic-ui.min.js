!function(e){e.module("coreGamesIonicUi.config",[]).config(["$httpProvider",function(e){e.defaults.withCredentials=!0}]).value("coreGamesIonicUi.config",{debug:!0}),e.module("coreGamesIonicUi.templates",[]),e.module("coreGamesIonicUi.controllers",[]),e.module("coreGamesIonicUi.services",[]),e.module("coreGamesIonicUi.interceptors",[]),e.module("coreGamesIonicUi",["ionic","ngCordova","coreGamesUi","coreGamesIonicUi.templates","coreGamesIonicUi.config","coreGamesIonicUi.interceptors","coreGamesIonicUi.services","coreGamesIonicUi.controllers"])}(angular),angular.module("coreGamesIonicUi.controllers").controller("CoreIonicNetworkCtrl",["$scope","$state","$cordovaNetwork","$timeout","$window","ENV",function(e,n,i,t,o,a){function s(){n.go("signin")}function c(){r.message="Checking network status...",0===o.location.href.indexOf("file")&&"localhost"!==a.domain?t(function(){try{if(i.isOnline())return s(),void 0}catch(e){if("navigator.connection is undefined"===e.message)return s(),void 0;console.log(e)}r.message="Internet not currently available."},1e3):s()}var r=this;e.$on("$cordovaNetwork:online",function(){s()}),e.$on("$ionicView.enter",function(){c()}),c()}]),angular.module("coreGamesIonicUi.controllers").controller("CoreIonicSignedInCtrl",["$scope","$state","$rootScope","$cacheFactory",function(e,n,i,t){function o(){t.get("$http").removeAll()}function a(){console.log("Logged in"),o(),i.$broadcast("login"),n.go("app.games")}e.$on("$ionicView.enter",function(){a()})}]),angular.module("coreGamesIonicUi.controllers").controller("CoreIonicSignInCtrl",["$scope","$window","$http","$state","$cacheFactory","jtbFacebook","ENV","$ionicLoading",function(e,n,i,t,o,a,s,c){function r(){o.get("$http").removeAll()}function l(){c.hide(),t.go("signedin")}function d(){c.hide(),console.log("Login failed"),r(),v.message="Invalid username or password."}function u(){v.showFacebook=!0,v.showManual="localhost"===s.domain||s.apiEndpoint.indexOf("-dev")>-1,v.message=""}function m(){v.showFacebook=!1,v.showManual=!1,v.message="Logging in via Facebook",r(),0===n.location.href.indexOf("file")?i.get(s.apiEndpoint+"/auth/facebook?code="+a.currentAuthorization().accessToken).success(l).error(d):n.location=s.apiEndpoint+"/auth/facebook"}var v=this;v.message="",v.showFacebook=!1,v.showManual=!1,v.manualForm={username:"",password:"",rememberMe:!1},v.manualLogin=function(){c.show({template:"Sending..."}),r(),i({transformRequest:function(e){var n=[];for(var i in e)e.hasOwnProperty(i)&&n.push(encodeURIComponent(i)+"="+encodeURIComponent(e[i]));return n.join("&")},url:"/signin/authenticate",data:{username:v.manualForm.username,password:v.manualForm.password,"remember-me":v.manualForm.rememberMe},headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST"}).success(l).error(d)},v.fbLogin=function(){a.initiateFBLogin().then(function(e){e.auto?m():u()},function(){u()})},e.$on("$ionicView.enter",function(){a.canAutoSignIn().then(function(e){r(),e.auto?m():u()},function(){u()})})}]),angular.module("coreGamesIonicUi.interceptors").factory("jtbApiEndpointInterceptor",["$q","ENV",function(e,n){return{request:function(e){return(e.url.indexOf("/api")>=0||e.url.indexOf("/auth")>=0||e.url.indexOf("/signout")>=0||e.url.indexOf("/livefeed")>=0||e.url.indexOf("/signin/authenticate")>=0)&&e.url.indexOf(n.apiEndpoint)<0&&(e.url=n.apiEndpoint+e.url),e}}}]).config(["$httpProvider",function(e){e.interceptors.push("jtbApiEndpointInterceptor")}]),angular.module("coreGamesIonicUi.services").factory("jtbIonicAds",["$cordovaGoogleAds","$cordovaDevice",function(e,n){function i(){e.prepareInterstitial({adId:d,autoShow:!1})}var t=12e4,o="iOS",a="browser",s="Android",c=new Date(0),r=t,l="",d="",u=!1;return document.addEventListener("onAdDismiss",function(e){"interstitial"===e.adType&&(c=new Date,i())}),document.addEventListener("onAdFailLoad",function(e){"interstitial"===e.adType&&i()}),document.addEventListener("onAdLeaveApp",function(e){"interstitial"===e.adType&&i()}),{initialize:function(t,c){if(angular.isDefined(c)&&(r=1e3*c),!u){try{l=n.getPlatform()}catch(m){l=a}switch(l){case o:d=t.ios.interstitial,i(),e.createBanner({adId:t.ios.banner,position:AdMob.AD_POSITION.BOTTOM_CENTER,autoShow:!0});break;case s:d=t.android.interstitial,i(),e.createBanner({adId:t.android.banner,position:AdMob.AD_POSITION.BOTTOM_CENTER,autoShow:!0});break;case a:!function(e,n,i){var t,o=e.getElementsByTagName(n)[0];e.getElementById(i)||(t=e.createElement(n),t.id=i,t.src="//developer.appprizes.com/applixir_richmedia.js",o.parentNode.insertBefore(t,o))}(document,"script","applixir-jssdk")}u=!0}},showInterstitial:function(){if(new Date-c>=r)switch(l){case o:case s:try{e.showInterstitial()}catch(n){console.warn(JSON.stringify(n)),i()}break;case a:try{invokeApplixirVideoUnitExtended(!1,"middle",function(){c=new Date})}catch(n){console.warn(JSON.stringify(n))}}}}}]),angular.module("coreGamesIonicUi.services").run(["$document","$state","$ionicLoading","$timeout","jtbLiveGameFeed",function(e,n,i,t,o){function a(){i.hide(),n.go("network")}var s,c=0;e.bind("pause",function(){console.warn("pause detected"),++c,s=t(function(){c>0?(console.info("pauseResumeStack still in pause - shutting down live feed"),c=0,s=void 0,o.suspendFeed()):console.info("ignoring pauseResumeStack, stack back to 0")},18e4)}),e.bind("resume",function(){console.warn("resume detected"),c>0?(console.info("pauseResumeStack stack reduced"),--c,0===c&&angular.isDefined(s)&&(console.info("clearing pause promise"),t.cancel(s),s=void 0)):(console.info("pauseResumeStack empty - full reconnect"),a())})}]),angular.module("coreGamesIonicUi.services").run(["$rootScope","$state","$ionicLoading","$ionicPopup",function(e,n,i,t){function o(){i.hide(),t.alert({title:"There was a problem!",template:"Going to reconnect!"}),n.go("network")}e.$on("InvalidSession",function(){"signin"!==n.$current.name?o():i.hide()}),e.$on("GeneralError",function(){o()}),e.$on("$cordovaNetwork:offline",function(){o()})}]),angular.module("coreGamesIonicUi.services").factory("jtbIonicGameActions",["$http","$q","$state","$ionicPopup","$ionicActionSheet","jtbGameCache","jtbPlayerService","$ionicLoading","jtbIonicAds",function(e,n,i,t,o,a,s,c,r){function l(e,n){t.alert({title:"Problem making move!",template:e}).then(function(){n.reject()})}function d(e){return s.currentPlayerBaseURL()+"/game/"+e.id+"/"}function u(){c.show({template:"Sending..."})}function m(){c.hide()}function v(e){var i=n.defer();return u(),e.then(function(e){var n=e.data;m(),a.putUpdatedGame(n),i.resolve(n)},function(e){console.error(e.data+"/"+e.status),m(),h(e.data,i)}),i.promise}function g(e,i){var t=n.defer();return o.show({buttons:[],destructiveText:e,titleText:"Are you sure?",cancelText:"Cancel",cancel:function(){t.reject()},destructiveButtonClicked:function(){v(i()).then(function(e){t.resolve(e)},function(){t.reject()})}}),t.promise}function f(n,i){return e.put(d(n)+i)}function p(e){return angular.isUndefined(e)&&(e=w),e()}var h=l,w=r.showInterstitial,b={getErrorHandler:function(){return h},setErrorHandler:function(e){h=e},getGameURL:function(e){return d(e)},wrapActionOnGame:function(e){return v(e)},wrapConfirmedActionOnGame:function(e,n){return g(e,n)},"new":function(n,t){p(t).then(function(){b.wrapActionOnGame(e.post(s.currentPlayerBaseURL()+"/new",n)).then(function(e){i.go("app."+e.gamePhase.toLowerCase(),{gameID:e.id})})})},accept:function(e,n){p(n).then(function(){b.wrapActionOnGame(f(e,"accept"))})},reject:function(e){b.wrapConfirmedActionOnGame("Reject this game!",function(){return f(e,"reject")})},declineRematch:function(e){b.wrapConfirmedActionOnGame("Decline further rematches.",function(){return f(e,"endRematch")})},rematch:function(e,n){p(n).then(function(){b.wrapActionOnGame(f(e,"rematch")).then(function(e){i.go("app."+e.gamePhase.toLowerCase(),{gameID:e.id})})})},quit:function(e){b.wrapConfirmedActionOnGame("Quit this game!",function(){return f(e,"quit")})}};return b}]),angular.module("coreGamesIonicUi.services").service("jtbIonicInviteFriends",["$ionicModal","$rootScope","jtbFacebook",function(e,n,i){return{inviteFriendsToPlay:function(t,o,a){angular.isUndefined(a)&&(a="templates/core-ionic/friends/invite-friends.html");var s,c=n.$new();c.invitableFriends=t,c.inviteFriends=function(e){var n=[];angular.forEach(e,function(e){n.push(e.id)}),i.inviteFriends(n,o),s.hide(),s.remove()},c.cancelInviteFriends=function(){s.hide(),s.remove()},e.fromTemplateUrl(a,{scope:c,animation:"slide-in-up"}).then(function(e){s=e,e.show()})}}}]);var WEEK_IN_MILLIS=6048e5;angular.module("coreGamesIonicUi.services").factory("jtbPushNotifications",["$http","$rootScope","$timeout","$window","jtbLocalStorage","jtbPlayerService",function(e,n,i,t,o,a){function s(n){if(console.log("register token called with "+JSON.stringify(n)),angular.isDefined(n)&&null!=n&&n.length>0&&"OK"!==n){console.log("Checking..");var i="pushNotification-"+a.currentPlayer().md5,t=i+"-token",s=i+"-last",c=o.get(t,""),r=new Date(parseInt(o.get(s,"0")));console.log("Last reg "+r.toLocaleString());var l=new Date-r;l>WEEK_IN_MILLIS||n!==c?(console.log("Registering"),e.put("/api/notifications/register/"+n).success(function(){o.set(t,n),o.set(s,(new Date).getTime()),d=n,console.log("registered device")}).error(function(e){console.error("failed to register device "+JSON.stringify(e))})):console.log("Recently registered.")}else console.log("Not registering")}function c(e){if(angular.isDefined(e.count)&&angular.isDefined(u))try{u.setApplicationIconBadgeNumber(function(){},function(){console.log("Failed to set badge")},e.count)}catch(n){}}function r(){}function l(e){s(e.registrationId)}var d,u;return n.$on("playerLoaded",function(){e.get("/api/notifications/senderID",{cache:!0}).success(function(e){if("NOTSET"!==e)if(angular.isDefined(window.PushNotification))if(angular.isDefined(u))console.log("Already registered for push, skipping");else{var n={android:{senderID:e,sound:!1,vibrate:!0},ios:{senderID:e,alert:!0,badge:!0,sound:!1,clearBadge:!0},windows:{}};u=PushNotification.init(n),u.on("registration",function(e){console.log("Registration "+JSON.stringify(e)),i(l(e))}),u.on("notification",function(e){console.log("Notification "+JSON.stringify(e)),i(c(e))}),u.on("error",function(e){console.log("Error "+JSON.stringify(e)),i(r(e))}),console.log("Initial registration for push completed")}else console.log("No PushNotification defined");else console.log("No sender id set (senderId = "+e+")")}).error(function(e){console.log("Not able to get senderID "+JSON.stringify(e))})}),{}}]),angular.module("coreGamesIonicUi.services").factory("jtbIonicVersionNotesService",["$ionicPopup","jtbPlayerService",function(e,n){return{displayVersionNotesIfAppropriate:function(i,t){n.currentPlayer().lastVersionNotes<i&&(e.alert({title:"Welcome to version "+i+"!",template:t}),n.updateLastVersionNotes(i))}}}]),angular.module("coreGamesIonicUi.templates").run(["$templateCache",function(e){e.put("templates/core-ionic/admin/admin-stats.html",'<div class="admin-stats"><div class="row text-right"><div class="col"></div><div class="col">Last 24 hours</div><div class="col">Last 7 days</div><div class="col">Last 30 days</div></div><div class="row text-right"><div class="col-25 text-left">Total Games</div><div class="col-75">{{admin.gameCount}}</div></div><div class="row text-right"><div class="col text-left">Games Created</div><div class="col">{{admin.gamesLast24hours}}</div><div class="col">{{admin.gamesLast7days}}</div><div class="col">{{admin.gamesLast30days}}</div></div><div class="row text-right"><div class="col-25 text-left">Total Players</div><div class="col-75">{{admin.playerCount}}</div></div><div class="row text-right"><div class="col text-left">Players Created</div><div class="col">{{admin.playersCreated24hours}}</div><div class="col">{{admin.playersCreated7days}}</div><div class="col">{{admin.playersCreated30days}}</div></div><div class="row text-right"><div class="col text-left">Players Logged In</div><div class="col">{{admin.playersLastLogin24hours}}</div><div class="col">{{admin.playersLastLogin7days}}</div><div class="col">{{admin.playersLastLogin30days}}</div></div></div>'),e.put("templates/core-ionic/admin/admin-switch-player.html",'<div class="admin-user"><div class="row row-center"><div class="col-25"><button class="button button-full button-positive button-stop-simulating" ng-disabled="!admin.revertEnabled" ng-click="admin.revertToNormal()">Stop</button></div><div class="col-75">{{admin.revertText}}</div></div><div class="row row-center"><div class="col-25"><button class="button button-full button-energized button-get-users" ng-click="admin.refreshData()">Get Users</button></div><div class="col-75"><div class="list"><label class="item item-input"><input type="text" ng-model="admin.searchText" placeholder="And Name contains.."></label></div></div></div><div class="item item-divider"><div class="row"><div class="col-50">Display Name</div><div class="col-25">ID</div><div class="col-25">Switch</div></div></div><div class="item" ng-repeat="player in admin.players"><div class="row row-center"><div class="col-50">{{player.displayName}}</div><div class="col-25">{{player.id}}</div><div class="col-25"><button class="button button-full button-assertive button-change-user" ng-click="admin.switchToPlayer(player.id)">Switch</button></div></div></div><div class="row"><div class="col-10">{{admin.currentPage}} of {{admin.numberOfPages}}</div><div class="col-90"><div class="item range range-positive"><input type="range" name="currentPage" min="1" max="{{admin.numberOfPages}}" ng-model="admin.currentPage" ng-change="admin.changePage()"></div></div></div></div>'),e.put("templates/core-ionic/admin/admin.html",'<ion-view class="admin-screen"><ion-content class="has-header" ng-cloak><div class="row"><div class="col-50"><a class="button-full button {{main.adminShowStats ? \'selected\' : \'\'}}" ng-click="main.adminSwitchToStats()">Stats</a></div><div class="col-50"><a class="button-full button {{main.adminShowSwitch ? \'selected\' : \'\'}}" ng-click="main.adminSwitchToSwitchPlayer()">Switch Player</a></div></div><div ng-show="main.adminShowStats"><div ng-include="\'templates/core-ionic/admin/admin-stats.html\'"></div></div><div ng-show="main.adminShowSwitch"><div ng-include="\'templates/core-ionic/admin/admin-switch-player.html\'"></div></div></ion-content></ion-view>'),e.put("templates/core-ionic/friends/invite-friends.html",'<!--  TODO - not using controllerAs because ionic modal 1.x does not support it --><div class="modal"><div class="invite-friends"><ion-header-bar><h1 class="title">Invite Friends!</h1></ion-header-bar><ion-content><div class="list"><label class="item item-input"><div style="width: 100%"><div class="input-label">Friends To Invite:</div></div></label><div angular-multi-select class="ams_container" min-search-length="1" helper-elements="filter noall nonone noreset" input-model="invitableFriends" output-model="friendsToInvite" button-template="angular-multi-select-btn-data.htm" item-label="<[ name ]>" search-property="name" button-label="<[ name ]>"></div></div><a class="button button-full button-submit" ng-click="inviteFriends(friendsToInvite)">Invite </a><a class="button button-full button-quit" ng-click="cancelInviteFriends()">Cancel</a></ion-content></div></div>'),e.put("templates/core-ionic/sign-in/network.html",'<ion-view><ion-content class="network"><div><div class="row text-center"><div class="center"><p>{{network.message}}</p></div></div></div></ion-content></ion-view>'),e.put("templates/core-ionic/sign-in/sign-in.html",'<ion-view><ion-content class="sign-in" ng-cloak><div class="row text-center"><div class="center"><p>{{signIn.message}}</p></div></div><div class="list" ng-show="signIn.showFacebook"><a class="item item-button" href="#" ng-click="signIn.fbLogin()"><img ng-src="images/sign-in-with-facebook.png"></a></div><div class="list" ng-show="signIn.showManual"><span class="item item-divider">Don\'t want to login with Facebook?</span><label class="item item-input"><span class="input-label">Email</span> <input id="username" name="username" type="email" size="25" ng-model="signIn.manualForm.username"></label><label class="item item-input"><span class="input-label">Password</span> <input id="password" name="password" type="password" size="25" ng-model="signIn.manualForm.password"></label><ion-toggle ng-model="signIn.manualForm.rememberMe">Remember Me?</ion-toggle><a class="button-full button-submit button" ng-click="signIn.manualLogin(username, password)">Login</a></div></ion-content></ion-view>'),e.put("templates/core-ionic/sign-in/signed-in.html",'<ion-view><ion-content class="signed-in"><div><div class="row text-center"><div class="center"><p>Login successful...</p></div></div></div></ion-content></ion-view>')}]);