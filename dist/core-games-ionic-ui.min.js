!function(e){e.module("coreGamesIonicUi.config",[]).value("coreGamesIonicUi.config",{debug:!0}),e.module("coreGamesIonicUi.controllers",[]),e.module("coreGamesIonicUi.services",[]),e.module("coreGamesIonicUi",["ionic","ngCordova","coreGamesUi","coreGamesIonicUi.config","coreGamesIonicUi.services","coreGamesIonicUi.controllers"])}(angular),angular.module("coreGamesIonicUi.controllers").controller("CoreIonicNetworkCtrl",["$scope","$state","$cordovaNetwork","$timeout","$window","ENV",function(e,o,n,i,r,t){function a(){o.go("signin")}function c(){e.message="Checking network status...",0===r.location.href.indexOf("file")&&"localhost"!==t.domain?i(function(){try{if(n.isOnline())return a(),void 0}catch(o){if("navigator.connection is undefined"===o.message)return a(),void 0;console.log(o)}e.message="Internet not currently available."},1e3):a()}e.$on("$cordovaNetwork:online",function(){a()}),e.$on("$ionicView.enter",function(){c()}),c()}]),angular.module("coreGamesIonicUi.controllers").controller("CoreIonicSignedInCtrl",["$scope","$state","$rootScope","$cacheFactory",function(e,o,n,i){function r(){i.get("$http").removeAll()}function t(){console.log("Logged in"),r(),n.$broadcast("login"),o.go("app.games")}e.$on("$ionicView.enter",function(){t()})}]),angular.module("coreGamesIonicUi.controllers").controller("CoreIonicSignInCtrl",["$scope","$window","$http","$state","$cacheFactory","jtbFacebook","ENV","$ionicLoading",function(e,o,n,i,r,t,a,c){function s(){r.get("$http").removeAll()}function l(){c.hide(),i.go("signedin")}function g(){c.hide(),console.log("Login failed"),s(),e.message="Invalid username or password."}function u(){e.showFacebook=!0,e.showManual="localhost"===a.domain||a.apiEndpoint.indexOf("-dev")>-1,e.message=""}function d(){e.showFacebook=!1,e.showManual=!1,e.message="Logging in via Facebook",s(),0===o.location.href.indexOf("file")?n.get(a.apiEndpoint+"/auth/facebook?code="+t.currentAuthorization().accessToken).success(l).error(g):o.location=a.apiEndpoint+"/auth/facebook"}e.message="",e.showFacebook=!1,e.showManual=!1,e.manualForm={username:"",password:"",rememberme:!1},e.manualLogin=function(){c.show({template:"Sending..."}),s(),n({transformRequest:function(e){var o=[];for(var n in e)e.hasOwnProperty(n)&&o.push(encodeURIComponent(n)+"="+encodeURIComponent(e[n]));return o.join("&")},url:"/signin/authenticate",data:{username:e.manualForm.username,password:e.manualForm.password,"remember-me":e.manualForm.rememberme},headers:{"Content-Type":"application/x-www-form-urlencoded"},method:"POST"}).success(l).error(g)},e.fbLogin=function(){t.initiateFBLogin().then(function(e){e.auto?d():u()},function(){u()})},e.$on("$ionicView.enter",function(){t.canAutoSignIn().then(function(e){s(),e.auto?d():u()},function(){u()})})}]),angular.module("coreGamesIonicUi.services").factory("jtbPushNotifications",["$http","$injector","$rootScope","$window","jtbLocalStorage","jtbPlayerService",function(e,o,n,i,r,t){function a(o){if(console.log("register token called with "+JSON.stringify(o)),angular.isDefined(o)&&null!=o&&o.length>0&&"OK"!==o){console.log("Checking..");var n="push-"+t.currentPlayer().md5,i=n+"-token",a=n+"-last",c=r.get(i,""),s=new Date(parseInt(r.get(a,"0")));console.log("Last reg "+s.toLocaleString());var l=s-new Date;l>u||o!==c?(console.log("Registering"),e.put("/api/notifications/register/"+o).success(function(){r.set(i,o),r.set(a,(new Date).getTime()),f=o,console.log("registered device")}).error(function(e){console.error("failed to register device "+JSON.stringify(e))})):console.log("Recently registered.")}else console.log("Not registering")}function c(e,o){switch(o.event){case"registered":o.regid.length>0?(console.log("registered cb "+o.regid),a(o.regid)):console.error("bad registered cb "+JSON.stringify(o));break;case"message":console.log("Received push message "+JSON.stringify(o));break;case"error":console.error("Received error message "+JSON.stringify(o));break;default:console.error("Received unknown message "+JSON.stringify(o))}}function s(e,o){angular.isDefined(o)&&(angular.isDefined(o.alert)&&navigator.notification.alert(o.alert),angular.isDefined(e.sound)&&console.log("play sound"+JSON.stringify(e.sound)),angular.isDefined(o.badge)&&l.setBadgeNumber(o.badge).then(function(){},function(){}))}var l,g,u=6048e5;try{0===i.location.href.indexOf("file:")&&(l=o.get("$cordovaPush"),g=o.get("$cordovaDevice"))}catch(d){l=void 0,g=void 0}var f;return n.$on("$cordovaPush:notificationReceived",function(e,o){console.log("notification notification "+JSON.stringify(o)),angular.isDefined(o)&&angular.isDefined(o.event)?c(e,o):s(e,o)}),n.$on("playerLoaded",function(){e.get("/api/notifications/senderID").success(function(e){if(angular.isDefined(l)&&angular.isDefined(g)){var o,n=g.getPlatform();o="android"===n||"Android"===n||"amazon-fireos"===n?{senderID:e}:{badge:!0,sound:!1,alert:!0},l.register(o).then(function(e){console.log("Push Token "+e),a(e)},function(e){console.log("Error registering "+JSON.stringify(e))})}}).error(function(){console.log("Not able to get senderID")})}),{register:function(){}}}]);